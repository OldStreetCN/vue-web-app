<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="/assets/bb7fcfb5/jquery.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.touchSwipe.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.form.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.storageapi.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.blockUI.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.jsonp-2.4.0.min.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/jquery.base64.js"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/taskhelper.js?v409"></script>
<script type="text/javascript" src="/themes/default/skins/webapp/js/touch-0.2.14.min_.js"></script>
<title>兑现</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<link href="/themes/default/skins/webapp/css/common.css?0621" type="text/css" rel="stylesheet">
<script language="javascript">
<!--
$(function(){
  
//安装地址
$.taskHelper.setInstallUrl("http://web.doudou.com/webapp/ddquwan/guide/goinstallhelper"); 
/**
 * 修改BlockUI默认样式 
 */
$.extend($.blockUI.defaults, {
	fadeIn: 500,
	overlayCSS: {
		backgroundColor: '#000',
		opacity: 0.7,
		cursor: 'normal',
	},
	onOverlayClick: function (){
		$.unblockUI();
	},
	css: {
		width:'80%',
		maxWidth: '330px',
		padding: '15px 15px',
		margin:'0 0 0 -45%',
		textAlign: 'center',
		backgroundColor: '#fff',	
		cursor: 'normal',
		left: '50%',
		top: '50%',
		border: '1px solid #e8e8e8'
	}
});
});
//-->
</script>
</head>

<body>


<!---最外边都要包一个pagewidth来限制页面最大宽度-->
<div class="pagewidth">
	<!--顶部导航-->
	<div class="header">
		<a href="javascript:history.go(-1);" class="hd_back"><i></i></a>
		<h3>兑现</h3>
		<a class="hd_right" href="/webapp/ddquwan/user/exchange/record"><span>兑换记录</span><i class="info_renwu_ico info_invitation_ico"></i></a>
	</div>
	<!--头部提示说明-->
	<div class="verification_prompt">
		<i></i><span>填写真实信息，才能兑现到账！（真实姓名为该微信号 绑定银行卡所对应的姓名）</span>
		<div class="clear"></div>
	</div>
	<form action="/webapp/ddquwan/user/exchange/wxpay" name="tocrashform" method="post" id="tocrashform">
	<!--选择金额-->
	<div class="exchange_list">
		<div class="money_title">
			<p>选择提现金额<span>可用余额：10.10元</span></p>
		</div>
		<ul class="money_list_box">
			<li>
				<!--金额选择：在未选中的状态下a标签为class：money_default，若在选中的状态下，a标签增加class：money_selected属性-->
				<a class="money_default">
					<!--选中的金额，i标签显示；未选中的金额，i标签不显示-->
					<input type="hidden" value="10" mid="2">
											<span>10元</span><em class="money_special">未激活特权</em><i></i>
									</a>
				<a class="money_default">
					<input type="hidden" value="20" mid="3">
					<span>20元</span><em>无门槛</em><i></i>
				</a>
				<a class="money_default">
					<input type="hidden" value="100" mid="4">
					<span>100元</span><em >无门槛</em><i></i>
				</a>
				<a class="money_default">
					<input type="hidden" value="1000" mid="5">
					<span>1000元</span><em>无门槛</em><i></i>
				</a>
			</li>
			<input type="hidden" name="alipaySum" id="exchange_preferentialType2" value="0"/>
			<input id="preferentialType" type="hidden" name="exchange[preferentialType]" value="0"/>
		</ul>
	</div>

	<div class="tipClass">
		<!--可以提现的情况下，填写信息-->
		<div class="exchange_list withdraw_info" style="display:none">
			<ul class="task_list_common">
				<li class="task_item_common">
					<label class="verification_prompt_icon icon_2"></label>
					<input placeholder="绑定微信银行卡的真实姓名" type="text" id="exchange_accountName" name="exchange[accountName]"  class="verification_prompt_input">
					<div class="clear"></div>
				</li>
				<li class="task_item_common">
					<label class="verification_prompt_icon icon_3"></label>
					<input value="18937111961" readonly="readonly" type="text" name="mobileNumber" id="mobileNumber" class="verification_prompt_input">
					<div class="clear"></div>
				</li>
									<li class="task_item_common noborderbottom">
						<label class="verification_prompt_icon icon_4"></label>
						<input placeholder="请输入手机验证码" type="text" name="mobileVerifyCode" id="mobileVerifyCode" class="verification_prompt_input short_input">

						<!-----获取验证码的这个btn，等待时间再一次发送验证码的时候还额外有个class是btn_dxyz_2_waiting,里面文字变成"60秒后重新获取"--->
						<input type="button" class="btn_dxyz_2"  id="sendMobileVerifyCodeBtn" value="获取验证码">
						<div class="clear"></div>
					</li>
							</ul>
			<div class="verification_prompt_bottom">
				<input style="margin:10px 0px; height:40px; color:#fff; font-size:15px; background:#faa71b; display:block; text-align:center; line-height:40px; border-radius:5px;width: 100%;border: none;" type="submit" value="提&nbsp;&nbsp;交" form="tocrashform" id="submitBtn" >
			</div>
		</div>

		<!--余额不足时的提醒-->
		<div class="exchange_list condition_remind balance_short" style="display:none">
			<i class="remind_1"></i>
			<p>您可用余额不足哦！</br>~继续加油做任务赚钱吧！~</p>
			<div class="condition_remind_but"><a class="but_yellow_2" href="/webapp/ddquwan/dashboard/index">去首页做任务<i class="to_verification"></i></a></div>
		</div>

		<!--余额不足，并且不符合提现特权的提醒-->
		<div class="exchange_list condition_remind balance_short_refuse" style="display:none">
			<i class="remind_2"></i>
			<p>您还未满足10元提现特权，且可用余额不足！~</br>先去激活特权，再加油做任务赚钱吧！~</p>
			<div class="condition_remind_but"><a class="but_yellow_2" href="/webapp/ddquwan/user/exchange/activation">去激活特权<i class="to_verification"></i></a></div>
		</div>

		<!--余额满足条件，但不满足提现特权的提醒-->
		<div class="exchange_list condition_remind balance_refuse"  style="display: none;">
			<i class="remind_2"></i>
			<p>您还未满足10元提现特权，先去激活特权吧！~</p>
			<div class="condition_remind_but"><a class="but_yellow_2" href="/webapp/ddquwan/user/exchange/activation">去激活特权<i class="to_verification"></i></a></div>
		</div>

		<!--未选择提现金额的提醒-->
		<div class="exchange_list condition_remind balance_null" >
			<i class="remind_3"></i>
			<p class="condition_remind_bottom">请先选择提现金额</p>
		</div>
	</div>
	</form>

	<!--底部的链接-->
	<a href="javascript:void(0);" class="problem_answer">查看微信如何绑定银行卡</a>


	<!---弹出----兑现信验证_绑定姓名有误-->
	<div class="remind_total remind_know remind_total_left"  style="display:none">
		<div class="remind_text">
			<span>您的真实姓名与微信绑定银行卡姓名不符，请查实后再次验证，若没有绑定银行卡，请前往微信钱包绑定银行卡。</span>
		</div>
		<div class="remind_foot" >
			<!---我知道了按钮---->
			<input  class="remind_btn" name="sub" value="我知道了" type="submit">
		</div>
	</div>


	<!---弹出-查看微信如何让绑定银行卡---->
	<div class="remind_total remind_know remind_bank_step" style="display:none">
		<a class="pop_close"></a>
		<div class="remind_text">
			<!---一张图片一个页面，手指右划换下一张---->
			<ul id="index_t">
				<li><i>1</i><span>打开【我】-【钱包】，点击【银行卡】；</span><img src="/themes/default/skins/webapp/images/pop/pop_bank_step_01.png" alt=""/></li>
				<li style="display:none"><i>2</i><span>点击【添加银行卡】输入卡号；</span><img src="/themes/default/skins/webapp/images/pop/pop_bank_step_02.png" alt=""/></li>
				<li style="display:none"><i>3</i><span>输入个人信息；</span><img src="/themes/default/skins/webapp/images/pop/pop_bank_step_03.png" alt=""/></li>
				<li style="display:none"><i>4</i><span>银行卡绑定成功，兑换可即时到账。</span><img src="/themes/default/skins/webapp/images/pop/pop_bank_step_04.png" alt=""/></li>
			</ul>
		</div>
		<!---与上面图片对应的点，select为选中状态---->
		<div class="remind_number">
			<ul id="index_n">
				<li class="select"></li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
		</div>
	</div>
	<!---黑色浮层---->
	<div class="z_box" style="display:none"></div>
</div>
<script type="text/javascript">
	<!--

	/*默认进来的时候判断*/
	var _balance = '10.1000'; //用户的钱
	var balance = parseInt(_balance);
	var Requirements =''; // 是否有特权领取首次10元的


	/*点击切换*/
	$('.money_list_box a').click(function(){
		$(this).addClass("money_selected").siblings().removeClass("money_selected");
		var inputVal = parseInt($(this).find('input').val()); // 选择要体现的金额
		$("#exchange_preferentialType2").val(inputVal);

		var mid = $(this).find('input').attr('mid');//$("[name=money]",$(this)).attr();
		$("#preferentialType").val(mid);
		//未选择提现金额的提醒
		if(inputVal <= 0){
			showDiv("balance_null",false);
			return;
		}
		// 针对10元提现的
		if(inputVal < 20){
			if(Requirements){
				if(balance<inputVal){
					// 余额不足
					showDiv("balance_short",false);
					return;
				}else{
					showDiv("withdraw_info",true);
					return;
				}
			}else{
				// 没有特权量取
				if(balance > inputVal){
					showDiv("balance_refuse",false);
					return;
				}else{
					showDiv("balance_short_refuse",false);
					return;
				}

			}
		}

		if(balance >= 20 && inputVal>=20 && balance >= inputVal)
		{
			showDiv("withdraw_info",true);
			return;
		}

		//余额不足时的提醒
		if(balance < inputVal){
			showDiv("balance_short",false);
			return;
		}

		//余额不足，并且不符合提现特权的提醒
		if(balance < inputVal && !Requirements){
			showDiv("balance_short_refuse",false);
			return;
		}

		//余额满足条件，但不满足提现特权的提醒
		if(!Requirements){
			showDiv("balance_refuse",false);
			return;
		}

	});


	function showDiv(cla,btn){
		$('.tipClass .exchange_list').hide();
		$('.tipClass .'+cla).show();
		if(btn){
			$('.verification_prompt_bottom').show();
		}else{
			$('.verification_prompt_bottom').hide();
		}
	}


	// 默认选中的提现金额
	//$("a.money_select").trigger("click");

	// 发送验证码
		var n;
	$("#sendMobileVerifyCodeBtn").click(function(){
		//alert("截止4月17日18点，微信系统维护，暂停提现！");return false;

		n=60;
		if($("#sendMobileVerifyCodeBtn").hasClass("btn_dxyz_2_waiting"))
			return false;

		var _mobileNumber=$.trim($("#mobileNumber").val());
		if(_mobileNumber=='' || /^1[3-9]\d{9}$/.test(_mobileNumber)===false)
		{
			alert("请输入正确手机号码");
			return false;
		}

		$("#sendMobileVerifyCodeBtn").attr("disabled","true");
		$("#sendMobileVerifyCodeBtn").addClass("btn_dxyz_2_waiting");
		$("#sendMobileVerifyCodeBtn").val("("+n+")s后重新获取");							//设定倒数计时秒数
		var time=setInterval(function(){
			if(n>1){
				n--;
				$("#sendMobileVerifyCodeBtn").val("("+n+")s后重新获取");
			}else{
				$("#sendMobileVerifyCodeBtn").val("获取验证码");
				$("#sendMobileVerifyCodeBtn").removeAttr("disabled");
				$("#sendMobileVerifyCodeBtn").removeClass("btn_dxyz_2_waiting");
				clearInterval(time);
				return false;
			}
		}, 1000);

		$.ajax({
			'url': "/webapp/ddquwan/user/exchange/mobileVerifyCode",
			'dataType': 'json',
			'data': {"mobileNumber": _mobileNumber},
			'success': function (result){
				if(result.status==1)
				{
					alert("验证码已通过短信发送至您的手机。");
				}else{
					alert(result.message?result.message:'验证码发送失败！');
				}
			},
			'error': function (){
				alert('验证码发送失败！');
			}
		});
	});

		var i=0
	// 查看微信银行卡绑定
	$(".problem_answer").click(function(){
		$('.remind_bank_step,.z_box').show();
	});
	$(".pop_close").click(function(){
		$('.remind_bank_step,.z_box').hide();
	});
	$("#index_t").swipe({
		swipe:function(event,direction, distance, duration, fingerCount) {
			if(direction == 'left'){
				if(i==3)return;
				else i++;
			}else{
				if(i==0)return;
				else i--;
			}
			$("#index_t>li").hide();
			$("#index_n>li").removeClass('select');
			$("#index_t li:eq("+i+")").show();
			$("#index_n li:eq("+i+")").addClass('select');
		},
	});

	// 提现表单提交处理
	$("#tocrashform").ajaxForm({
		dataType: 'json',
		beforeSubmit: function(arr, $form, options) {

			var sName=$.trim($("#exchange_accountName").val());
			var sMoney=$.trim($("#exchange_preferentialType2").val());

			if(sName==''){
				alert("请输入微信钱包绑定的真实姓名！");
				$("#exchange_accountName").focus();
				return false;
			}

			if(sMoney==''){
				alert("请选择提现金额");
				$("#exchange_preferentialType2").trigger('click');
				return false;
			}
			var sMobileNumber=$.trim($("#mobileNumber").val());
			if(sMobileNumber==''){
				alert("请填写该微信绑定的手机号码");
				$("#mobileNumber").focus();
				return false;
			}

						var sMobileVerifyCode=$.trim($("#mobileVerifyCode").val());
			if(sMobileVerifyCode==''){
				alert("请填写短信验证码");
				$("#mobileVerifyCode").focus();
				return false;
			}
						$("#submitBtn").attr("disabled",true);
			$.blockUI({message:"<div style=\"font-size:12px;\">提交中（约10秒）...</div>", showOverlay:false});
		},
		success: function (result){
			//alert('返回了');
			$.unblockUI();
			if(result.status==1)
			{
				$("#tocrashform").resetForm();
				window.location.href="/webapp/ddquwan/user/exchange/success";
				// 真实姓名不对
			}else if(result.status=='-1'){
				alert(result.message);
			}else{
				alert(result.message);
			}

			$("#submitBtn").attr("disabled", false);
		},
		error: function (result){
			//提交失败，请稍后重试~
			$.unblockUI();
			alert("提交失败，请稍后重试~");
			$("#submitBtn").attr("disabled", false);
		}
	});
	//-->
</script>
</body>
</html>
